<!--*** INICIO ****************************************************************************************************-->
<ng-container *ngIf="!imprimir && !showForm">
<p-table
  #tbl
  [value]="apListar"
  [columns]="cols"
  [lazy]="false"
  [totalRecords]="apListar.length"
  [sortField]="sortField"
  dataKey="andamento_proposicao_id"
  [scrollable]="true"
  scrollHeight="flex"
  [reorderableColumns]="true"
  [resizableColumns]="true"
  [autoLayout]="false"
  columnResizeMode="expand"
  [rowHover]="true"
  [responsive]="false"
  (onColReorder)="onColReorder($event)"
  [tableStyle]="{'font-size':'14px'}"
  [style]="{width:'calc(100% - 20px)'}"
  selectionMode="multiple"
  styleClass="tablistagem p-datatable-sm p-datatable-striped p-datatable-gridlines"
>
  <!--*** TITULOS *************************************************************************************************-->
  <ng-template pTemplate="caption">
    <div class="p-d-inline-flex p-ai-center">
      <div class="p-mx-2">ANDAMENTOS DA PROPOSIÇÃO</div>
    </div>
    <div class="p-d-inline-flex p-ai-end">
      <div class="p-mr-2">Num. Registros: {{apListar.length}}</div>
    </div>
  </ng-template>

  <ng-template pTemplate="colgroup" let-columns>
    <colgroup>
      <col *ngFor="let col of columns">
    </colgroup>
  </ng-template>

  <ng-template pTemplate="header" let-columns>
    <tr>
      <th style="width: 3rem" *ngIf="permitirAcao"></th>
      <th *ngFor="let col of columns"
          [pSortableColumn]="col.field"
          [style.width]="col.width"
          pReorderableColumn
          pResizableColumn
      >
        {{col.header}}
        <p-sortIcon [field]="col.field"></p-sortIcon>
      </th>
    </tr>
  </ng-template>

  <!--*** DADOS ****************************************************************************************************-->
  <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
    <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
      <td style="width: 3rem; vertical-align:top; text-align: left" *ngIf="permitirAcao">
        <div *ngIf="permitirAlterar" class="p-py-1 p-pr-2">
          <button
            #tgl
            id="tgh{{rowIndex}}"
            [pTooltip]="'Alterar'"
            pButton
            pRipple
            type="button"
            icon="pi pi-pencil"
            class="historico p-button-sm p-button-rounded p-button-warning"
            tooltipPosition="top"
            (click)="editar(rowData, rowIndex)"
          >
          </button>
        </div>

        <div *ngIf="permitirApagar" class="p-py-1 p-pr-2">
          <p-confirmPopup></p-confirmPopup>
          <button pButton pRipple type="button" icon="pi pi-trash" pTooltip="APAGAR"
                  class="historico p-button-sm p-button-rounded p-button-danger"
                  (click)="confirm($event, +rowData['andamento_proposicao_id'], rowIndex)"></button>
        </div>
      </td>
      <td *ngFor="let col of columns" [style.width]="col.width" style="vertical-align: top">
        <app-quill-view *ngIf="col.field === 'andamento_proposicao_texto'"
                        [cphtml]="rowData['andamento_proposicao_texto']"
                        [cpdelta]="rowData['andamento_proposicao_texto_delta']"></app-quill-view>
        <div *ngIf="col.field !== 'andamento_proposicao_texto'" class="p-text-uppercase">{{rowData[col.field]}}</div>
      </td>
    </tr>
  </ng-template>

</p-table>
</ng-container>

<ng-container *ngIf="!imprimir && showForm">
  <ng-container *ngIf="acao==='alterar'">
    <app-andamento-proposicao-form
      [apListar]="apListar"
      [(andamento)]="form"
      [acao]="acao"
      [andamento_proposicao_proposicao_id]="andamento_proposicao_proposicao_id"
      [idx]="idx"
      [(display)]="showForm"
    ></app-andamento-proposicao-form>
  </ng-container>
  <ng-container *ngIf="acao==='incluir'">
    <app-andamento-proposicao-form
      [apListar]="apListar"
      [acao]="acao"
      [andamento_proposicao_proposicao_id]="andamento_proposicao_proposicao_id"
      [(display)]="showForm"
    ></app-andamento-proposicao-form>
  </ng-container>
</ng-container>

<!--*** FIM ********************************************************************************************************-->

<br>
<div class="botoesdetalhe2">
  <div class="p-mr-2">
    <button
      pButton
      pRipple
      type="button"
      class="botaoinferior p-button-secondary"
      label="Fechar"
      [disabled]="botaoEnviarVF"
      (click)="fechar()"
    ></button>
  </div>
  <div *ngIf="permitirIncluir" class="p-mr-2">
    <button
      pButton
      pRipple
      icon="pi pi-plus"
      type="button"
      class="botaoinferior p-ripple p-button-rounded"
      (click)="incluir()"
      label="Incluir"
      [disabled]="botaoEnviarVF"
    ></button>
  </div>
</div>


